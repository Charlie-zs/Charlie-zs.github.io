<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>宝宝的刷题App</title>
    <meta name="theme-color" content="#ffffff">
    <link rel="manifest" href="manifest.json">
    <link rel="stylesheet" href="style.css">
<link rel="stylesheet" href="/index.css">
</head>
<body>
    <div class="app-container">
        <div id="quiz-view" class="view">
            <header id="app-header" class="app-header"></header>
            <main class="app-main">
                <div id="status-bar" class="quiz-status-bar"></div>
                <div id="quiz-status" class="quiz-status" style="display: none;"></div>
                <div class="question-container"><p id="question-text" class="question-text"></p></div>
                <div class="options-container"><ul id="options-list"></ul></div>
                <div id="analysis-container" class="analysis-container"><h4>💡 答案解析</h4><p id="analysis-text"></p></div>
                <div id="no-wrong-questions" style="display:none; text-align:center; margin-top: 50px;"><h3>🎉 太棒了!</h3><p>错题本是空的哦！</p></div>
            </main>
            <footer id="app-footer" class="app-footer"></footer>
        </div>

        <div id="settings-view" class="view" style="display: none;">
            <header class="app-header">
                <span id="back-to-quiz-btn" class="clickable">← 返回</span><span>个人界面</span><span></span>
            </header>
            <main class="settings-main">
                <div class="settings-group">
                    <h3>⚝ 题库管理</h3>
                    <button onclick="importQuestions()">导入题库 (.txt)</button>
                    <button onclick="exportQuestions()">导出/保存当前题库</button>
                    <input type="file" id="file-importer" accept=".txt" style="display:none;">
                    <p>导入的题库会覆盖现有题目。请记得随时导出备份！</p>
                </div>
                 <div class="settings-group">
                    <h3>ꉂ ^˶ᵒ ᵕ ˂˶ ^ฅ AI 设置</h3>
                    <button onclick="showAISettingsView()">前往 AI 设置</button>
                 </div>
                <div class="settings-group">
                    <h3>🎨 美化功能</h3>
                    <textarea id="custom-css-textarea" placeholder="在这里粘贴你的CSS美化代码..."></textarea>
                    <button onclick="applyCustomCSS()">应用美化</button>
                </div>
            </main>
        </div>

        <div id="ai-settings-view" class="view" style="display: none;">
             <header class="app-header">
                <span id="back-to-settings-btn" class="clickable">← 返回</span><span>AI 设置</span><span></span>
            </header>
            <main class="settings-main">
                <div class="settings-group">
                    <label for="api-platform">API 平台</label>
                    <select id="api-platform">
                        <option value="google-gemini">Google Gemini</option>
                        <option value="openai">OpenAI</option>
                        <option value="custom">自定义兼容</option>
                    </select>
                    <label for="api-url">API URL</label>
                    <input type="text" id="api-url" placeholder="选择平台后将显示示例URL">
                    <label for="api-key">API Key</label>
                    <input type="password" id="api-key" placeholder="在此输入您的 API Key">
                    <label for="api-model">模型名称</label>
                    <input type="text" id="api-model" placeholder="例如: gemini-2.5-flash">
                    <label for="api-system-prompt">AI 提示词 (System Prompt)</label>
                    <textarea id="api-system-prompt" placeholder="例如: 你是一个友好的、循循善诱的老师..."></textarea>
                    <div class="button-row">
                        <button onclick="testAPIConnection()">测试连接</button>
                        <button onclick="saveSettings()">保存设置</button>
                    </div>
                    <p id="api-test-feedback"></p>
                </div>
            </main>
        </div>

        <div id="ai-tutor-modal" class="modal-overlay" style="display: none;">
            <div class="modal-content gemini-chat-modal">
                <header class="modal-header">
                    <h3>AI 答疑</h3>
                    <span class="close-modal-btn" onclick="closeAITutorModal()">&times;</span>
                </header>
                <div id="ai-chat-history" class="ai-chat-history">
                    <!-- Chat messages will be dynamically inserted here -->
                </div>
                <div id="ai-thinking-indicator" class="ai-thinking-indicator" style="display: none;">
                    <div class="spinner"></div>
                    <span id="ai-thinking-timer">思考中...</span>
                </div>
                <footer class="modal-footer">
                    <div class="ai-input-container">
                        <textarea id="ai-user-query" placeholder="问点什么吧..." rows="1"></textarea>
                        <button id="ai-send-btn" onclick="askAI()">
                            <svg height="24px" viewBox="0 0 24 24" width="24px" fill="currentColor"><path d="M0 0h24v24H0V0z" fill="none"></path><path d="M2.01 21L23 12 2.01 3 2 10l15 2-15 2 .01 7z"></path></svg>
                        </button>
                    </div>
                </footer>
            </div>
        </div>
    </div>
    <script src="script.js" defer></script>
    <script>
        if ('serviceWorker' in navigator) {
            window.addEventListener('load', () => {
                navigator.serviceWorker.register('/sw.js').then(registration => {
                    console.log('ServiceWorker registration successful with scope: ', registration.scope);
                }, err => {
                    console.log('ServiceWorker registration failed: ', err);
                });
            });
        }
    </script>
<script type="module" src="/index.tsx"></script>
</body>

</html>
